<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="CREATE" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">// Use song in the creation code to specify.
// Ex. song = "ClockTower" to play ClockTowerIntro and ClockTowerLoop
// Starts by playing ClockTowerIntro, then plays ClockTowerLoop when it's done. See the step event to find out about how that's timed.
// Check this out https://github.com/arkrow/PyMusicLooper to make loops.

// There's probably a lib somewhere that would be better for this. But, while I cared enough to put way to much effort into this, I didn't care enough to redo everything having to do with saudio.dll.
// To smoothly transition, the intro has 5s of the loop at the end, and the loop is seeked to line up properly.

// mp3s don't seem to have their positions reported correctly (which the intro needs) so the intro is a wav
// wavs don't seem to consistently loop correctly (which the loop needs) so the loop is an mp3
// it's gross I know. but the saudio documentation was deleted years ago and it works so I'm keeping it

intromid = song + "Intro"
loopmid = song + "Loop"
scr_LoadMusicLater(intromid);
scr_LoadMusicLater(loopmid);

// Stop if music is disabled
if global.musicon = 0 exit;

// Stop if this song is already playing
if global.cmusic != string(intromid) and global.cmusic != string(loopmid) {
    introisover = false;
    // Stop all other music
    saud_StopAll();
    
    // Play this song
    saud_Seek(0,string(intromid));
    saud_Play(string(intromid));
    
    // Remember that this song is already playing
    global.cmusic = string(intromid);
}
else if global.cmusic = string(intromid) {
    introisover = false;
}
else if global.cmusic = string(loopmid) {
    introisover = true;
}



</argument>
      </arguments>
    </action>
  </actions>
</event>
